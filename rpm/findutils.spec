Name:       findutils
Summary:    The GNU versions of find utilities (find and xargs)
Version:    4.6.0
Release:    1
Group:      Applications/File
License:    GPLv3+
URL:        http://www.gnu.org/software/findutils/
Source0:    %{name}-%{version}.tar.gz
Patch0:     findutils-4.6.0-no-locate.patch
Patch1:     findutils-4.6.0-gnulib-fflush.patch
Patch2:     findutils-4.6.0-gnulib-makedev.patch
Provides:   gnu-findutils
BuildRequires:  libtool
BuildRequires:  automake
BuildRequires:  autoconf
BuildRequires:  gnu-gzip
BuildRequires:  gettext-devel
BuildRequires:  texinfo
BuildRequires:  bison

%description
The findutils package contains programs which will help you locate
files on your system.  The find utility searches through a hierarchy
of directories looking for files which match a certain set of criteria
(such as a filename pattern).  The xargs utility builds and executes
command lines from standard input arguments (usually lists of file
names generated by the find command).

You should install findutils because it includes tools that are very
useful for finding things on your system.

%package doc
Summary:    Documentation for %{name}
Group:      Documentation
Requires:   %{name} = %{version}-%{release}
Requires(post): /sbin/install-info
Requires(postun): /sbin/install-info

%description doc
Man and info pages for %{name}.

%prep
%setup -q -n %{name}-%{version}/upstream

# findutils-4.6.0-no-locate.patch
%patch0 -p1

# findutils-4.6.0-gnulib-fflush.patch
%patch1 -p1

# findutils-4.6.0-gnulib-makedev.patch
%patch2 -p1

%build
export CFLAGS="$RPM_OPT_FLAGS -D_GNU_SOURCE"
export CXXFLAGS="$RPM_OPT_FLAGS -D_GNU_SOURCE"

./bootstrap --no-git --gnulib-srcdir=gnulib --skip-po

%configure --without-selinux

make %{?_smp_mflags}

%install
rm -rf %{buildroot}
%make_install

rm -f $RPM_BUILD_ROOT%{_infodir}/dir

mkdir -p %{buildroot}/bin
pushd %{buildroot}/bin
ln -sf ../usr/bin/find
popd
%find_lang %{name}

mkdir -p %{buildroot}%{_docdir}/%{name}-%{version}
install -m0644 -t %{buildroot}%{_docdir}/%{name}-%{version} \
        AUTHORS NEWS README THANKS TODO

%post doc
%install_info --info-dir=%_infodir %{_infodir}/find.info.gz
%install_info --info-dir=%_infodir %{_infodir}/find-maint.info.gz
%install_info --info-dir=%_infodir %{_infodir}/find.info-1.gz
%install_info --info-dir=%_infodir %{_infodir}/find.info-2.gz


%postun doc
if [ $1 = 0 ] ;then
%install_info_delete --info-dir=%{_infodir} %{_infodir}/find.info.gz
%install_info_delete --info-dir=%{_infodir} %{_infodir}/find-maint.info.gz
%install_info_delete --info-dir=%{_infodir} %{_infodir}/find.info-1.gz
%install_info_delete --info-dir=%{_infodir} %{_infodir}/find.info-2.gz
fi

%files -f %{name}.lang
%defattr(-,root,root,-)
%license COPYING
%{_bindir}/find
/bin/find
%{_bindir}/xargs

%files doc
%defattr(-,root,root,-)
%{_mandir}/man1/find.1*
%{_mandir}/man1/xargs.1*
%{_infodir}/find*.gz
%{_docdir}/%{name}-%{version}
